---
import BaseHead from '../components/BaseHead.astro';
export interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!DOCTYPE html>
<html
  lang="en"
  class="scroll-smooth selection:bg-accent-500 selection:text-white no-touchevents hydrated">
  <head>
    <BaseHead />
    <script is:inline>
      const theme = (() => {
        if (
          typeof localStorage !== 'undefined' &&
          localStorage.getItem('theme')
        ) {
          return localStorage.getItem('theme');
        }
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          return 'dark';
        }
        return 'light';
      })();

      if (theme === 'light') {
        document.documentElement.classList.remove('dark');
      } else {
        document.documentElement.classList.add('dark');
      }
      window.localStorage.setItem('theme', theme);
    </script>
  </head>
  <body class="mx-auto bg-white dark:bg-gray-900">
    <slot />
    <div
      class="bg-white shadow-md rounded-lg p-6 w-full mx-auto dark:bg-gray-700">
      <h2
        class="text-black dark:text-white text-2xl font-medium mb-4 text-center">
        Subscribe to my newsletter
      </h2>
      <p class="text-black dark:text-white mb-4 text-center">
        Sign up to receive news, updates, and interesting articles. No spam or
        ads.
      </p>

      <form class="flex items-center">
        <div class="flex-grow mr-4">
          <div class="flex items-center justify-center">
            <input
              class="shadow appearance-none border rounded w-64 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              id="email"
              type="email"
              placeholder="Enter your email address"
              required
            />
            <button
              id="subscribe-btn"
              class="bg-blue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-l focus:outline-none focus:shadow-outline"
              type="submit">Subscribe</button
            >
          </div>
        </div>
      </form>

      <p
        id="thank-you"
        class="hidden bg-gradient-to-r from-blue to-red dark:from-pink dark:to-orange text-xl text-transparent bg-clip-text font-bold text-center mt-4">
        Thank you for subscribing!
      </p>

      <script>
        const subscribeBtn = document.getElementById('subscribe-btn');
        const emailInput = document.getElementById('email');
        const thankYouMessage = document.getElementById('thank-you');

        subscribeBtn.addEventListener('click', async (event) => {
          event.preventDefault();

          const response = await fetch('/api/subscribe', {
            method: 'POST',
            body: JSON.stringify({ email: emailInput.value }),
            headers: {
              'Content-Type': 'application/json',
            },
          });

          if (response.ok) {
            // Show the thank you message
            thankYouMessage.classList.remove('hidden');
            // Scroll to the thank you message
            thankYouMessage.scrollIntoView({ behavior: 'smooth' });
          } else {
            // Error message
            console.error('Failed to subscribe:', response.statusText);
          }
        });
      </script>
    </div>
  </body>
</html>
